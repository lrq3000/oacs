<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>OACS: C:/oacs/oacs/oacs/run.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OACS
   </div>
   <div id="projectbrief">Server-side anti-cheat system for online games</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('run_8py_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">run.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="run_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="code" href="namespaceoacs_1_1run.html">    1</a></span>&#160;<span class="comment">#!/usr/bin/env python</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"># encoding: utf-8</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">from</span> auxlib <span class="keyword">import</span> *</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">from</span> <a class="code" href="namespaceoacs_1_1configparser.html">oacs.configparser</a> <span class="keyword">import</span> ConfigParser</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">import</span> os, StringIO</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">import</span> time</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno"><a class="code" href="namespaceoacs_1_1run.html#a098e026a7ef4c2251e2b9c6d7762fdb0">   11</a></span>&#160;json = <a class="code" href="namespaceoacs_1_1auxlib.html#aa8c86b0d489fda02795de102cdf218c7">import_module</a>(<span class="stringliteral">&#39;ujson&#39;</span>)</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keywordflow">if</span> json <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    json = <a class="code" href="namespaceoacs_1_1auxlib.html#aa8c86b0d489fda02795de102cdf218c7">import_module</a>(<span class="stringliteral">&#39;json&#39;</span>)</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    <span class="keywordflow">if</span> json <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;        <span class="keywordflow">raise</span> RuntimeError(<span class="stringliteral">&#39;Unable to find a json implementation&#39;</span>)</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno"><a class="code" href="classoacs_1_1run_1_1_runner.html">   17</a></span>&#160;<span class="keyword">class </span><a class="code" href="classoacs_1_1run_1_1_runner.html">Runner</a>:</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno"><a class="code" href="classoacs_1_1run_1_1_runner.html#a7ba591fbd63d9cc9a4c21017c1065447">   19</a></span>&#160;    rootdir = <span class="stringliteral">&#39;oacs&#39;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="comment">## @var vars contain a dynamical dict of variables used for data mining, and will be passed to every other computational function</span></div>
<div class="line"><a name="l00022"></a><span class="lineno"><a class="code" href="classoacs_1_1run_1_1_runner.html#a1d6d28009d9f8735512ff13a20daa05d">   22</a></span>&#160;    vars = {} <span class="comment"># we create a reference at startup so that this dict can be passed as a reference to children objects</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <span class="comment">## Initialize a runner object, with all constructs necessary to use the algorithms and process data according to the provided configuration file and commandline arguments</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="comment"># @param args recognized and processed commandline arguments</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="comment"># @param extras extra commandline arguments that are not explicitly recognized (but will nevertheless be appended to the config file, so that you can overwrite pretty much any configuration parameter you want at commandline)</span></div>
<div class="line"><a name="l00027"></a><span class="lineno"><a class="code" href="classoacs_1_1run_1_1_runner.html#ae637776bd9299bd48b6c7677ba3e42f0">   27</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classoacs_1_1run_1_1_runner.html#ae637776bd9299bd48b6c7677ba3e42f0" title="Initialize a runner object, with all constructs necessary to use the algorithms and process data acco...">init</a>(self, args, extras):</div>
<div class="line"><a name="l00028"></a><span class="lineno"><a class="code" href="classoacs_1_1run_1_1_runner.html#a66b28e31dc0903a72eb742588750ddd9">   28</a></span>&#160;        self.<a class="code" href="classoacs_1_1run_1_1_runner.html#a1d6d28009d9f8735512ff13a20daa05d">vars</a> = dict()</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        <span class="comment">#-- Loading config</span></div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="code" href="classoacs_1_1run_1_1_runner.html#a69598c6b75ee54d7670972a87bcc1756">   30</a></span>&#160;        self.<a class="code" href="classoacs_1_1run_1_1_runner.html#a69598c6b75ee54d7670972a87bcc1756">config</a> = <a class="code" href="classoacs_1_1configparser_1_1_config_parser.html" title="ConfigParser.">ConfigParser</a>()</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        configfile = args[<span class="stringliteral">&#39;config&#39;</span>]; del args[<span class="stringliteral">&#39;config&#39;</span>] <span class="comment"># delete the config argument, which is at best a self reference</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        self.config.init(configfile)</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        self.config.load(args, extras)</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        <span class="comment">#-- Loading classes</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        <span class="keywordflow">for</span> (submod, classname) <span class="keywordflow">in</span> self.config.config[<span class="stringliteral">&quot;classes&quot;</span>].iteritems(): <span class="comment"># for each item/module specified in classes</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;            <span class="comment"># if it is a list of classes, we load all the classes into a local list of classes</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;            <span class="keywordflow">if</span> <a class="code" href="namespaceoacs_1_1lib_1_1debug_1_1memory__profiler.html#aaf54155ea7b4f6625da6636b57a90066">type</a>(classname) == <a class="code" href="namespaceoacs_1_1lib_1_1debug_1_1memory__profiler.html#aaf54155ea7b4f6625da6636b57a90066">type</a>(list()):</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;                self.__dict__[submod] = {} <span class="comment"># initializing the local list of classes</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                <span class="comment"># for each class in the list</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                <span class="keywordflow">for</span> classname2 <span class="keywordflow">in</span> classname:</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                    <span class="comment"># we add the class</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                    self.<a class="code" href="classoacs_1_1run_1_1_runner.html#a041103f09db09ef2bb358ada8f81f371" title="Instanciate dynamically a class and add it to the local dict.">addclass</a>(submod, classname2, <span class="keyword">True</span>)</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;            <span class="comment"># if a special string &quot;all&quot; is supplied, we load all the classes into a local list of classes (if a class with a similar name to the filename exists - the classname can have mixed case, the case doesn&#39;t matter if the filename corresponds to the classname.lower())</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;            <span class="keywordflow">elif</span> classname == <span class="stringliteral">&#39;all&#39;</span>:</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                self.__dict__[submod] = {} <span class="comment"># initializing the local list of classes</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                modlist = os.listdir(os.path.join(self.<a class="code" href="classoacs_1_1run_1_1_runner.html#a7ba591fbd63d9cc9a4c21017c1065447">rootdir</a>, submod)) <span class="comment"># loading the list of files/submodules</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                modlist = list(set([os.path.splitext(mod)[0] <span class="keywordflow">for</span> mod <span class="keywordflow">in</span> modlist])) <span class="comment"># strip out the extension + get only unique values (else we will get .py and .pyc filenames, which are in fact the same module)</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                <span class="comment"># Trim out the base class and __init__</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                <span class="comment"># Remove all base modules (modules whose names starts with &#39;base&#39;)</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                [modlist.remove(mod) <span class="keywordflow">for</span> mod <span class="keywordflow">in</span> modlist <span class="keywordflow">if</span> mod.startswith(<span class="stringliteral">&#39;base&#39;</span>)]</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                <span class="comment"># Remove all __init__ modules (these are only used by the python interpreter)</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                <span class="keywordflow">if</span> <span class="stringliteral">&#39;__init__&#39;</span> <span class="keywordflow">in</span> modlist:</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                    modlist.remove(<span class="stringliteral">&#39;__init__&#39;</span>)</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                <span class="comment"># For each submodule</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                <span class="keywordflow">for</span> classname2 <span class="keywordflow">in</span> modlist:</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                    full_package = <span class="stringliteral">&#39;.&#39;</span>.join([self.<a class="code" href="classoacs_1_1run_1_1_runner.html#a7ba591fbd63d9cc9a4c21017c1065447">rootdir</a>, submod, classname2.lower()])</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                    mod = <a class="code" href="namespaceoacs_1_1auxlib.html#aa8c86b0d489fda02795de102cdf218c7">import_module</a>(full_package) <span class="comment"># we need to load the package before being able to list the classes contained inside</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                    <span class="comment"># We list all objects contained in this module (normally we expect only one class, but nevermind)</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                    <span class="keywordflow">for</span> iclass, iclassname <span class="keywordflow">in</span> [(obj, obj.__name__) <span class="keywordflow">for</span> obj <span class="keywordflow">in</span> [getattr(mod, name) <span class="keywordflow">for</span> name <span class="keywordflow">in</span> dir(mod)] <span class="keywordflow">if</span> isinstance(obj, type)]:</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                        <span class="comment"># If the object is a class, and the class name is the same as the filename, we add an instance of this class!</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                        <span class="keywordflow">if</span> iclassname.lower() == classname2.lower():</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                            <span class="comment"># we add the class</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                            self.<a class="code" href="classoacs_1_1run_1_1_runner.html#a041103f09db09ef2bb358ada8f81f371" title="Instanciate dynamically a class and add it to the local dict.">addclass</a>(submod, iclassname, <span class="keyword">True</span>)</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            <span class="comment"># if we just have a string, we add the class that corresponds to this string</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            <span class="comment"># Note: the format must be &quot;submodule&quot;: &quot;ClassName&quot;, where submodule is the folder containing the subsubmodule, and &quot;ClassName&quot; both the class name, and the subsubmodule filename (&quot;classname.py&quot;)</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                self.<a class="code" href="classoacs_1_1run_1_1_runner.html#a041103f09db09ef2bb358ada8f81f371" title="Instanciate dynamically a class and add it to the local dict.">addclass</a>(submod, classname)</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">True</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">## Instanciate dynamically a class and add it to the local dict</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment"># @param submod name of the subfolder/submodule where the subsubmodule resides</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment"># @param classname both the subsubmodule filename (eg: classname.py) and the class name (eg: ClassName)</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment"># @param listofclasses if True, instanciate this class in a list of classes, instead of just directly a property of the current object (eg: instead of self.inputparser, you will get: self.inputparser[&quot;firstparser&quot;], self.inputparser[&quot;secondparser&quot;], etc...)</span></div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="code" href="classoacs_1_1run_1_1_runner.html#a041103f09db09ef2bb358ada8f81f371">   77</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classoacs_1_1run_1_1_runner.html#a041103f09db09ef2bb358ada8f81f371" title="Instanciate dynamically a class and add it to the local dict.">addclass</a>(self, submod, classname, listofclasses=False):</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            aclass = <a class="code" href="namespaceoacs_1_1auxlib.html#af8644a06a4db73f6b10ae9a4a7d0de18">import_class</a>(<span class="stringliteral">&#39;.&#39;</span>.join([self.<a class="code" href="classoacs_1_1run_1_1_runner.html#a7ba591fbd63d9cc9a4c21017c1065447">rootdir</a>, submod, classname.lower()]), classname)</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            <span class="keywordflow">if</span> listofclasses:</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.__dict__[submod]: self.__dict__[submod] = OrderedDict() <span class="comment"># keep the order in which the items were given (all iterators will also follow the order). This allows to set in config the order in which we want the items to be executed.</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                self.__dict__[submod][classname.lower()] = aclass(config=self.<a class="code" href="classoacs_1_1run_1_1_runner.html#a69598c6b75ee54d7670972a87bcc1756">config</a>, parent=self)</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                self.__dict__[submod] = aclass(config=self.<a class="code" href="classoacs_1_1run_1_1_runner.html#a69598c6b75ee54d7670972a87bcc1756">config</a>, parent=self)</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">True</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="keywordflow">except</span> Exception, e:</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            package_full = <span class="stringliteral">&#39;.&#39;</span>.join([self.<a class="code" href="classoacs_1_1run_1_1_runner.html#a7ba591fbd63d9cc9a4c21017c1065447">rootdir</a>, submod, classname.lower()])</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            print(<span class="stringliteral">&quot;CRITICAL ERROR: importing a class failed: classname: %s package: %s\nException: %s&quot;</span> % (package_full, classname, str(e)))</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <span class="keywordflow">raise</span> RuntimeError(<span class="stringliteral">&#39;Unable to import a class&#39;</span>)</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">## Update the local dict vars of variables</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">#</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment"># This function is used as a proxy to accept any arbitrary number of returned arguments from functions, and will store them locally, and then the vars dict will be passed onto other children objects</span></div>
<div class="line"><a name="l00094"></a><span class="lineno"><a class="code" href="classoacs_1_1run_1_1_runner.html#af41e21348ffb2feb33939c4f2d71df86">   94</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classoacs_1_1run_1_1_runner.html#af41e21348ffb2feb33939c4f2d71df86" title="Update the local dict vars of variables.">updatevars</a>(self, dictofvars):</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="comment"># Create the local vars dict if it does not exist</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> hasattr(self, <span class="stringliteral">&#39;vars&#39;</span>):</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            self.<a class="code" href="classoacs_1_1run_1_1_runner.html#a1d6d28009d9f8735512ff13a20daa05d">vars</a> = {}</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="comment"># Update/add the values inside dictofvars (if it is a dictionary of variables)</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="keywordflow">if</span> <a class="code" href="namespaceoacs_1_1lib_1_1debug_1_1memory__profiler.html#aaf54155ea7b4f6625da6636b57a90066">type</a>(dictofvars) == <a class="code" href="namespaceoacs_1_1lib_1_1debug_1_1memory__profiler.html#aaf54155ea7b4f6625da6636b57a90066">type</a>(dict()):</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            self.vars.update(dictofvars) <span class="comment"># add new variables from dict and merge updated values for already existing variables</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="comment"># Else, it may be a list or an object or just a scalar (this means the function is not conforming to the dev standards), then can&#39;t know where to put those results and we just memorize them inside a &quot;lastout&quot; entry as-is.</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="comment"># In summary: unnamed variables gets stored as temporary variables which may be overwritten at any time by subsequent functions</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            <span class="comment"># Delete the previous output</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            <span class="keywordflow">if</span> self.vars.get(<span class="stringliteral">&quot;lastout&quot;</span>, <span class="keywordtype">None</span>): del self.<a class="code" href="classoacs_1_1run_1_1_runner.html#a1d6d28009d9f8735512ff13a20daa05d">vars</a>[<span class="stringliteral">&quot;lastout&quot;</span>]</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <span class="comment"># Save this output</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            self.vars.update({<span class="stringliteral">&quot;lastout&quot;</span>: dictofvars})</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="comment">## Generically call one object and its method (if obj is a list, it will call the method of each and every one of the modules in the list)</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment"># @param obj Object or list of objects</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment"># @param method Method to call in the object(s) (as string)</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment"># @param args Optional arguments to pass to the method</span></div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="code" href="classoacs_1_1run_1_1_runner.html#aa1bbbff4ca5864611adbb3f7e4797add">  113</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classoacs_1_1run_1_1_runner.html#aa1bbbff4ca5864611adbb3f7e4797add" title="Generically call one object and its method (if obj is a list, it will call the method of each and eve...">generic_call</a>(self, obj, method, args=None):</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="comment"># Create the local dict of vars</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        allvars = dict()</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="comment"># If we have a list of modules to call, we call the method of each and every one of those modules</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="keywordflow">if</span> isinstance(obj, (dict, OrderedDict)):</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            <span class="comment"># For every module in the list</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            <span class="keywordflow">for</span> submodule <span class="keywordflow">in</span> obj.itervalues():</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                <span class="comment"># Update the local dict of vars</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                allvars.update(self.<a class="code" href="classoacs_1_1run_1_1_runner.html#a1d6d28009d9f8735512ff13a20daa05d">vars</a>)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                <span class="keywordflow">if</span> args <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> <a class="code" href="namespaceoacs_1_1lib_1_1debug_1_1memory__profiler.html#aaf54155ea7b4f6625da6636b57a90066">type</a>(args) == dict: allvars.update(args)</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                <span class="comment"># Get the callable object&#39;s method</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                fullfunc = getattr(submodule, method)</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                <span class="comment"># Call the specified function for the specified module</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                self.<a class="code" href="classoacs_1_1run_1_1_runner.html#af41e21348ffb2feb33939c4f2d71df86" title="Update the local dict vars of variables.">updatevars</a>(fullfunc(**allvars))</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="comment"># Else if it is an object, we directly call its method</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            <span class="comment"># Get the callable object&#39;s method</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            fullfunc = getattr(obj, method)</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <span class="comment"># Call the specified function for the specified module</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            self.<a class="code" href="classoacs_1_1run_1_1_runner.html#af41e21348ffb2feb33939c4f2d71df86" title="Update the local dict vars of variables.">updatevars</a>(fullfunc(**self.<a class="code" href="classoacs_1_1run_1_1_runner.html#a1d6d28009d9f8735512ff13a20daa05d">vars</a>))</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment">## Generically call any module given a list of dicts containing {&quot;submodule name&quot;: &quot;method of the class to call&quot;}</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment"># @param executelist A list containing the sequence of modules to launch (Note: the order of the contained elements matters!)</span></div>
<div class="line"><a name="l00136"></a><span class="lineno"><a class="code" href="classoacs_1_1run_1_1_runner.html#aeab1a7dbb55227c67872fba3e3b913ef">  136</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classoacs_1_1run_1_1_runner.html#aeab1a7dbb55227c67872fba3e3b913ef" title="Generically call any module given a list of dicts containing {&quot;submodule name&quot;: &quot;method of the class ...">execute</a>(self, executelist):</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="comment"># Loop through all modules in run_learn list</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="keywordflow">for</span> mod <span class="keywordflow">in</span> executelist:</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            <span class="comment"># Catch exceptions: if a module fails, we continue onto the next one</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            <span class="comment">#try:</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <span class="comment"># Special case: this is a sublist, we run all the modules in the list in parallel</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            <span class="keywordflow">if</span> <a class="code" href="namespaceoacs_1_1lib_1_1debug_1_1memory__profiler.html#aaf54155ea7b4f6625da6636b57a90066">type</a>(mod) == <a class="code" href="namespaceoacs_1_1lib_1_1debug_1_1memory__profiler.html#aaf54155ea7b4f6625da6636b57a90066">type</a>(list()):</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                self.<a class="code" href="classoacs_1_1run_1_1_runner.html#aa1bbbff4ca5864611adbb3f7e4797add" title="Generically call one object and its method (if obj is a list, it will call the method of each and eve...">generic_call</a>(mod) <span class="comment"># TODO: launch each submodule in parallel (using subprocess or threading, but be careful: Python&#39;s threads aren&#39;t efficient so this is not useful at all, and subprocess creates a new object, so how to communicate the computed/returned variables efficiently in memory?)</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                <span class="comment"># Unpacking the dict</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                module = mod.keys()[0]</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                func = mod.values()[0]</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                self.<a class="code" href="classoacs_1_1run_1_1_runner.html#aa1bbbff4ca5864611adbb3f7e4797add" title="Generically call one object and its method (if obj is a list, it will call the method of each and eve...">generic_call</a>(self.__dict__[module], func)</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                <span class="comment">#self.updatevars(self.learningalgo.learn(**self.vars))</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                <span class="comment"># dans learningalgo faire un if self.config.config[&#39;bigdata&#39;] self.learn_bulk() or self.learn_bigdata()</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                <span class="comment">#eg: return {&#39;X&#39;: df, &#39;Y&#39;: something, etc..}</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            <span class="comment">#except Exception, e:</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                <span class="comment">#print &quot;Exception when executing the routine: %s&quot; % str(e)</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">True</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">## Write down the parameters into a file</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment"># Format of the file: json structure consisting of a dict where the keys are the names of the vars, and the values are strings encoding the data in csv format</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment"># TODO: replace by pandas.to_json() when the feature will be put back in the main branch?</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    @staticmethod</div>
<div class="line"><a name="l00162"></a><span class="lineno"><a class="code" href="classoacs_1_1run_1_1_runner.html#af2d0f710c3c46413146dc82bf3ea1519">  162</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classoacs_1_1run_1_1_runner.html#af2d0f710c3c46413146dc82bf3ea1519" title="Write down the parameters into a file Format of the file: json structure consisting of a dict where t...">save_vars</a>(jsonfile, dictofvars, exclude=None):</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="comment">## Simple function to insert an item in either a dict or a list</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="keyword">def </span>addtolistordict(finaldict, key, item):</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            <span class="keywordflow">if</span> isinstance(finaldict, (dict)):</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                finaldict[key] = item</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            <span class="keywordflow">elif</span> isinstance(finaldict, (list, tuple)):</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                finaldict.insert(key, item)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="comment">## Recursively convert variables into a json intelligible format</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keyword">def </span>convert_vars(dictofvars, exclude=None):</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            <span class="comment"># Loading the correct generator depending on the type of dictofvars</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            <span class="comment"># If it&#39;s a dict we iter over items</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            <span class="keywordflow">if</span> (isinstance(dictofvars, dict)):</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                iter = dictofvars.iteritems()</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                finaldict = dict()</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            <span class="comment"># If it&#39;s a list we enumerate it</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <span class="keywordflow">elif</span> (isinstance(dictofvars, (list, tuple))):</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                iter = enumerate(dictofvars)</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                finaldict = list()</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            <span class="comment"># For each object in our dict of variables</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            <span class="keywordflow">for</span> (key, item) <span class="keywordflow">in</span> iter:</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                    <span class="comment"># If this variable is in the exclude list, we skip it</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                    <span class="keywordflow">if</span> exclude <span class="keywordflow">and</span> key <span class="keywordflow">in</span> exclude:</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                            <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                <span class="comment"># Try to save the pandas object as CSV</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                <span class="comment">#try:</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                    <span class="comment"># Only try if there is a method to_csv()</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                    <span class="comment"># TODO: replace by pandas.to_json() when the feature will be put back in the main branch?</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                    <span class="keywordflow">if</span> (hasattr(item, <span class="stringliteral">&#39;to_csv&#39;</span>)):</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                        out = StringIO.StringIO()</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                        item.to_csv(out)</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                        addtolistordict(finaldict, key, out.getvalue())</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                    <span class="comment"># Else it is probably not a Pandas object since this method is not available, we just save the value as-is or recursively convert pandas objects if possible</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                        <span class="comment"># If this is a recursive object, try to convert the variables inside (they may be pandas objects)</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                        <span class="keywordflow">if</span> (isinstance(item, (list, dict, tuple)) <span class="keywordflow">and</span> <span class="keywordflow">not</span> isinstance(item, basestring)):</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                            addtolistordict(finaldict, key, convert_vars(item))</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                        <span class="comment"># Else just save the item as-is</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                            addtolistordict(finaldict, key, item)</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                <span class="comment"># Else if it is not a pandas object, we save as-is</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                <span class="keywordflow">except</span> Exception, e:</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                    addtolistordict(finaldict, key, item)</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                    print(<span class="stringliteral">&quot;Notice: couldn&#39;t correctly convert the value for the key %s. The value will be saved as-is. Error: %s&quot;</span> % (key, e))</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                    <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            <span class="keywordflow">return</span> finaldict</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="comment"># Convert recursively the dict of vars</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        finaldict = convert_vars(dictofvars, exclude)</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="comment"># Save the dict of csv data as a JSON file</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            f = open(jsonfile, <span class="stringliteral">&#39;wb&#39;</span>) <span class="comment"># open in binary mode to avoid line returns translation (else the reading will be flawed!). We have to do it both at saving and at reading.</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            f.write( json.dumps(finaldict, sort_keys=<span class="keyword">True</span>, indent=4) ) <span class="comment"># write the file as a json serialized string, but beautified to be more human readable</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            f.close()</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">True</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="keywordflow">except</span> Exception, e:</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            print(<span class="stringliteral">&quot;Exception while trying to save the parameters into the parameters file: %s. The parameters have not been saved!&quot;</span> % e)</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">False</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="comment">## Load the parameters from a file</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment"># Format of the file: json structure consisting of a dict where the keys are the names of the vars, and the values are strings encoding the data in csv format</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment"># TODO: replace by pandas.from_json() when the feature will be put back in the main branch?</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    @staticmethod</div>
<div class="line"><a name="l00229"></a><span class="lineno"><a class="code" href="classoacs_1_1run_1_1_runner.html#a702225db2e52b3a4bbcecca84902ea0b">  229</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classoacs_1_1run_1_1_runner.html#a702225db2e52b3a4bbcecca84902ea0b" title="Load the parameters from a file Format of the file: json structure consisting of a dict where the key...">load_vars</a>(jsonfile):</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="comment">## Simple function to insert an item in either a dict or a list</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keyword">def </span>addtolistordict(finaldict, key, item):</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <span class="keywordflow">if</span> isinstance(finaldict, (dict)):</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                finaldict[key] = item</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <span class="keywordflow">elif</span> isinstance(finaldict, (list, tuple)):</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                finaldict.insert(key, item)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="comment">## Convert back variables and returns a dict</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="comment"># This is mainly because we need to convert back pandas objects, because pandas does not provide a to_json() function anymore</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="comment"># TODO: replace all this by a simple to_json() when it will be fixed in Pandas?</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="comment"># @param d Can be either a dict or a list</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="keyword">def </span>convert_vars(d):</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            <span class="comment"># Loading the correct generator depending on the type of dictofvars</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            <span class="comment"># If it&#39;s a dict we iter over items</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="keywordflow">if</span> (isinstance(d, dict)):</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                iter = d.iteritems()</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                dictofvars = dict()</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="comment"># If it&#39;s a list we enumerate it</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            <span class="keywordflow">elif</span> (isinstance(d, (list, tuple))):</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                iter = enumerate(d)</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                dictofvars = list()</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            <span class="comment"># For each item in the json</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <span class="keywordflow">for</span> key, item <span class="keywordflow">in</span> iter:</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                <span class="comment"># TODO: Pandas objects are stored in a string for the moment because to_json() was removed. Fix this with a more reliable way to decode those structures in the future.</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                <span class="keywordflow">if</span> (isinstance(item, basestring)):</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                    <span class="comment"># Try to load a pandas object (Series or DataFrame)</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                    <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                        buf = StringIO.StringIO(item)</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                        df = pd.read_csv(buf, index_col=0, header=0) <span class="comment"># by default, load as a DataFrame</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                        <span class="comment"># if in fact it&#39;s a Series (a vector), we reload as a Series</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                        <span class="comment"># TODO: replace all this by pd.read_csv(buf, squeeze=True) when squeeze will work!</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                        <span class="keywordflow">if</span> df.shape[1] == 1:</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                            buf.seek(0)</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                            addtolistordict(dictofvars, key, pd.Series.from_csv(buf))</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                            <span class="comment"># Failsafe: in case we tried to load a Series but it didn&#39;t work well (pandas will failsafe and return the original string), we finally set as a DataFrame</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="namespaceoacs_1_1lib_1_1debug_1_1memory__profiler.html#aaf54155ea7b4f6625da6636b57a90066">type</a>(dictofvars[key]) != <a class="code" href="namespaceoacs_1_1lib_1_1debug_1_1memory__profiler.html#aaf54155ea7b4f6625da6636b57a90066">type</a>(pd.Series()) <span class="keywordflow">and</span> <a class="code" href="namespaceoacs_1_1lib_1_1debug_1_1memory__profiler.html#aaf54155ea7b4f6625da6636b57a90066">type</a>(dictofvars[key]) != <a class="code" href="namespaceoacs_1_1lib_1_1debug_1_1memory__profiler.html#aaf54155ea7b4f6625da6636b57a90066">type</a>(pd.DataFrame()) <span class="keywordflow">or</span> dictofvars[key].dtype == object ): <span class="comment"># if it&#39;s neither a Series nor DataFrame, we expect the item to be a DataFrame and not a Series</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                                addtolistordict(dictofvars, key, df)</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                        <span class="comment"># Else if it is really a DataFrame, we set it as DataFrame</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                            <span class="keywordflow">if</span> (<span class="keywordflow">not</span> df.empty):</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                                addtolistordict(dictofvars, key, df)</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                            <span class="comment"># In the case it is really a string (the resulting pandas object is empty), we just store the string as-is</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                                addtolistordict(dictofvars, key, item)</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                    <span class="comment"># If it didn&#39;t work well, we load the object as-is (maybe it&#39;s simply a string)</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                    <span class="keywordflow">except</span> Exception, e:</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                        addtolistordict(dictofvars, key, item)</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                        print(<span class="stringliteral">&quot;Exception: couldn&#39;t correctly load the value for the key %s. Error: %s. This item will be skipped.&quot;</span> % (key, e))</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                        <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                <span class="comment"># Else it is already a converted Python object (eg: a list, a dict, a number, etc...), we just use it as-is</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                    <span class="keywordflow">if</span> isinstance(item, (dict, list, tuple)) <span class="keywordflow">and</span> <span class="keywordflow">not</span> isinstance(item, basestring):</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                        addtolistordict(dictofvars, key, convert_vars(item))</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                        addtolistordict(dictofvars, key, item)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <span class="keywordflow">return</span> dictofvars</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="comment"># Open the file</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        with open(jsonfile, <span class="stringliteral">&#39;rb&#39;</span>) <span class="keyword">as</span> f:</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            filecontent = f.read()</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="comment"># Load the json tree</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        jsontree = json.loads(filecontent)</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <span class="comment"># Convert recursively the dict of vars (for pandas objects)</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        dictofvars = convert_vars(jsontree)</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="comment"># Return the list of variables/parameters</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="keywordflow">return</span> dictofvars</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="comment">## Train the system to learn how to detect cheating</span></div>
<div class="line"><a name="l00308"></a><span class="lineno"><a class="code" href="classoacs_1_1run_1_1_runner.html#aa40a5c3bb71a0b2bbe227c8b9903f7f4">  308</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classoacs_1_1run_1_1_runner.html#aa40a5c3bb71a0b2bbe227c8b9903f7f4" title="Train the system to learn how to detect cheating.">learn</a>(self, executelist=None):</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="comment"># We can pass an execution list either as an argument (used for recursion) or in the configuration</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> executelist:</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            executelist = self.config.config.get(<span class="stringliteral">&#39;run_learn&#39;</span>, <span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <span class="comment"># Standard learning routine</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="comment"># If no routine is given, then we execute the standard learning routine</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> executelist:</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            executelist = []</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            <span class="keywordflow">if</span> self.__dict__.get(<span class="stringliteral">&#39;preoptimization&#39;</span>, <span class="keywordtype">None</span>):</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                executelist.append({<span class="stringliteral">&quot;preoptimization&quot;</span>: <span class="stringliteral">&quot;optimize&quot;</span>})</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            executelist.append({<span class="stringliteral">&quot;classifier&quot;</span>: <span class="stringliteral">&quot;learn&quot;</span>})</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="keywordflow">if</span> self.__dict__.get(<span class="stringliteral">&#39;postoptimization&#39;</span>, <span class="keywordtype">None</span>):</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                executelist.append({<span class="stringliteral">&quot;postoptimization&quot;</span>: <span class="stringliteral">&quot;optimize&quot;</span>})</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="comment"># Load the data prior to the execution of the learning routine</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.config.config.get(<span class="stringliteral">&#39;bigdata&#39;</span>):</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            self.<a class="code" href="classoacs_1_1run_1_1_runner.html#aa1bbbff4ca5864611adbb3f7e4797add" title="Generically call one object and its method (if obj is a list, it will call the method of each and eve...">generic_call</a>(self.inputparser, <span class="stringliteral">&#39;load&#39;</span>)</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">else</span>: <span class="comment"># Special case: for the input parser, we call the read method if we are in bigdata mode</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            self.<a class="code" href="classoacs_1_1run_1_1_runner.html#af41e21348ffb2feb33939c4f2d71df86" title="Update the local dict vars of variables.">updatevars</a>({<span class="stringliteral">&#39;X&#39;</span>: self.inputparser.read()}) <span class="comment"># we put the generator of variables in X</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="comment"># Execute all modules of the routine (either of config[&#39;run_learn&#39;] or the standard routine)</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        self.<a class="code" href="classoacs_1_1run_1_1_runner.html#aeab1a7dbb55227c67872fba3e3b913ef" title="Generically call any module given a list of dicts containing {&quot;submodule name&quot;: &quot;method of the class ...">execute</a>(executelist)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="comment"># End of learning, we save the parameters if a parametersfile was specified</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="keywordflow">if</span> self.config.config.get(<span class="stringliteral">&#39;parametersfile&#39;</span>, <span class="keywordtype">None</span>):</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            Runner.save_vars(self.config.config[<span class="stringliteral">&#39;parametersfile&#39;</span>], self.<a class="code" href="classoacs_1_1run_1_1_runner.html#a1d6d28009d9f8735512ff13a20daa05d">vars</a>, [<span class="stringliteral">&#39;X&#39;</span>, <span class="stringliteral">&#39;Y&#39;</span>, <span class="stringliteral">&#39;X_raw&#39;</span>]) <span class="comment"># save all vars but X and Y (which may be VERY big and aren&#39;t parameters anyway)</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">True</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment">## Main/Prediction loop</span></div>
<div class="line"><a name="l00339"></a><span class="lineno"><a class="code" href="classoacs_1_1run_1_1_runner.html#af48da6b1e10e4dd267d2ca7dc6a635f6">  339</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classoacs_1_1run_1_1_runner.html#af48da6b1e10e4dd267d2ca7dc6a635f6" title="Main/Prediction loop.">run</a>(self, executelist=None):</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="comment"># Load the parameters if a file is specified</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="keywordflow">if</span> self.config.config.get(<span class="stringliteral">&#39;parametersfile&#39;</span>, <span class="keywordtype">None</span>):</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            self.<a class="code" href="classoacs_1_1run_1_1_runner.html#af41e21348ffb2feb33939c4f2d71df86" title="Update the local dict vars of variables.">updatevars</a>(Runner.load_vars(self.config.config[<span class="stringliteral">&#39;parametersfile&#39;</span>]))</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <span class="comment"># We can pass an execution list either as an argument (used for recursion) or in the configuration</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> executelist:</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            executelist = self.config.config.get(<span class="stringliteral">&#39;run&#39;</span>, <span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="comment"># Standard detection routine</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="comment"># If no routine is given, then we execute the standard detection routine</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> executelist:</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            executelist = []</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            <span class="keywordflow">if</span> self.__dict__.get(<span class="stringliteral">&#39;postoptimization&#39;</span>, <span class="keywordtype">None</span>):</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                executelist.append({<span class="stringliteral">&quot;postoptimization&quot;</span>: <span class="stringliteral">&quot;optimize&quot;</span>})</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            executelist.append({<span class="stringliteral">&quot;classifier&quot;</span>: <span class="stringliteral">&quot;predict&quot;</span>})</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            executelist.append({<span class="stringliteral">&quot;decider&quot;</span>: <span class="stringliteral">&quot;decide&quot;</span>})</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            <span class="keywordflow">if</span> self.__dict__.get(<span class="stringliteral">&#39;postaction&#39;</span>, <span class="keywordtype">None</span>):</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                executelist.append({<span class="stringliteral">&quot;postaction&quot;</span>: <span class="stringliteral">&quot;action&quot;</span>})</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <span class="comment"># Caching a few vars (faster than accessing methods)</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        run_minisleep = self.config.config.get(<span class="stringliteral">&#39;run_minisleep&#39;</span>, 0.01)</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        run_sleep = self.config.config.get(<span class="stringliteral">&#39;run_sleep&#39;</span>, 1)</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="comment"># Main loop</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="keywordflow">while</span> 1:</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                <span class="comment"># Set the reading cursor at the end of the file (last line)</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                skip_to_end = <span class="keyword">True</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.config.config.get(<span class="stringliteral">&#39;simulatedetection&#39;</span>, <span class="keywordtype">None</span>):</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                    skip_to_end=<span class="keyword">False</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                <span class="comment"># Get the samples generator</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                gen = self.inputparser.read(skip_to_end=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                <span class="comment"># For each samples in the generator</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                <span class="keywordflow">for</span> dictofvars <span class="keywordflow">in</span> gen:</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                    <span class="comment"># No new lines yet? We just wait for the next iteration after having slept a bit</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                    <span class="keywordflow">if</span> dictofvars <span class="keywordflow">is</span> <span class="keywordtype">None</span>: <span class="keywordflow">break</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                    <span class="comment"># Add them to the global list of variables</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                    self.<a class="code" href="classoacs_1_1run_1_1_runner.html#af41e21348ffb2feb33939c4f2d71df86" title="Update the local dict vars of variables.">updatevars</a>(dictofvars)</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                    <span class="comment"># Execute all modules of the routine (either of config[&#39;run&#39;] or the standard routine)</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                    self.<a class="code" href="classoacs_1_1run_1_1_runner.html#aeab1a7dbb55227c67872fba3e3b913ef" title="Generically call any module given a list of dicts containing {&quot;submodule name&quot;: &quot;method of the class ...">execute</a>(executelist)</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                    <span class="comment"># Sleep a bit between each sample to give the hand to other processes</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                    time.sleep(run_minisleep)</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                <span class="comment"># Sleep a bit between each batch of new samples (here we finished the last batch and reached the end of file, wait a bit because anyway there won&#39;t be any new sample ASAP)</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                time.sleep(run_sleep)</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            <span class="comment"># Exit gracefully in case the user CTRL-C to stop the process</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            <span class="keywordflow">except</span> KeyboardInterrupt:</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                <span class="keywordflow">return</span> 0</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">True</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="keywordflow">if</span> __name__ == <span class="stringliteral">&#39;__main__&#39;</span>:</div>
<div class="line"><a name="l00391"></a><span class="lineno"><a class="code" href="namespaceoacs_1_1run.html#ab8a70134e76e88858f73eca03bcc743a">  391</a></span>&#160;    runner = <a class="code" href="classoacs_1_1run_1_1_runner.html">Runner</a>()</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    runner.init()</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    runner.run()</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_95dea3d10c9f98c1baa90e87e0175c9f.html">oacs</a></li><li class="navelem"><a class="el" href="dir_3841315bfd9ffd1d6ca7b95fc4faf1e8.html">oacs</a></li><li class="navelem"><a class="el" href="dir_21b84646a66e1b24a785a648bc86a4ce.html">oacs</a></li><li class="navelem"><a class="el" href="run_8py.html">run.py</a></li>
    <li class="footer">Generated on Thu May 9 2013 17:43:11 for OACS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
